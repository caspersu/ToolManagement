@using Kendo.Mvc.UI;
@model Tool_Management.Service.ViewModels.CNCViewModel
@{
    ViewBag.Title = "機台維護";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="main">
    <div class="block">
        <div class="title">機台維護</div>
    </div>
    <p>&nbsp;</p>
    <hr>
    <p>&nbsp;</p>
    <div class="container-fluid">

        <div class="form-horizontal" id="queryForm">
            @Html.AntiForgeryToken()

            <div class="block">
                <div class="row">
                    @Html.LabelFor(m => m.CNC_IP, htmlAttributes: new { @class = "control-label col-md-2" })
                    <div class="col-md-2">
                        @Html.TextBoxFor(m => m.CNC_IP, new { @class = "form-control", placeholder = Html.DisplayNameFor(m => m.CNC_IP) })
                        <p class="help-block">
                        </p>
                    </div>

                </div>
            </div>

            <div class="container-button text-center">
                <button class="btn btn-primary" id="btnQuery" data-loading-text="查詢">查詢</button>
            </div>
            <p>&nbsp;</p>
            <hr>
            <p>&nbsp;</p>
            <div class="block">
                <div class="sub_tit">
                    查詢結果
                </div>
                <p>&nbsp;</p>

                <section class="section-grid">
                    @(Html.Kendo().Grid<Tool_Management.Service.ViewModels.CNCViewModel>()
                        .Name("grid")
                        .Columns(columns =>
                        {
                            columns.Bound(c => c.CNC_IP)
                            .HtmlAttributes(new { @class = "gridCell-center" }).Width(120);
                            columns.Bound(c => c.CNC_ID)
                            .HtmlAttributes(new { @class = "gridCell-center" }).Width(120);
                            columns.Bound(c => c.CNC_Name)
                            .HtmlAttributes(new { @class = "gridCell-center" }).Width(100);
                            columns.Bound(c => c.CNC_Brand)
                            .HtmlAttributes(new { @class = "gridCell-center" }).Width(150);
                            columns.Bound(c => c.CNC_Create_DT)
                            .Format("{0:yyyy/MM/dd HH:mm:ss}")
                            .HtmlAttributes(new { @class = "gridCell-center" }).Width(100);
                            columns.Bound(c => c.CNC_Create_Name)
                            .HtmlAttributes(new { @class = "gridCell-center" }).Width(100);
                            columns.Bound(c => c.CNC_Modify_DT)
                            .Format("{0:yyyy/MM/dd HH:mm:ss}")
                            .HtmlAttributes(new { @class = "gridCell-center" }).Width(100);
                            columns.Bound(c => c.CNC_Modify_Name)
                            .HtmlAttributes(new { @class = "gridCell-center" }).Width(100);

                            columns.Command(command =>
                            {
                                command.Edit().Text("修改").UpdateText("確認").CancelText("取消");
                                //command.Destroy().Text("刪除");
                            }).Title("功能");
                        })
                        .ToolBar(toolbar => toolbar.Create().Text("新增"))
                        .Editable(editable => editable.Mode(GridEditMode.PopUp).TemplateName("SectionTemplate")
                            .Window(w =>
                            {
                                w.Title("機台維護");
                                w.Events(e => { e.Activate("onDeactivate"); });
                            })
                          )
                        .Resizable(r => r.Columns(true))
                        .Scrollable(scrollable => scrollable.Height("auto"))
                        .Sortable()
                        .NoRecords("查無資料")
                        .Pageable(
                            pageable => pageable.Refresh(true)
                            .PageSizes(new[] { 10 })
                            .Messages(m =>
                            {
                                m.Empty("查無資料");
                                m.ItemsPerPage("每頁筆數");
                                m.Display("{0} - {1} 共 {2} 筆");
                            })
                        )
                        .DataSource(dataSource => dataSource
                            .Ajax()
                            .Sort(s => { s.Add(o => o.CNC_IP).Descending(); })
                            //.Events(events => events.Error("error_handler"))
                            .Model(model => { model.Id(p => p.CNC_IP); })
                            .Read(read => read.Action("GridSearch", "CNC"))
                            .Create(update => update.Action("EditingPopup_Create", "CNC"))
                            .Update(update => update.Action("EditingPopup_Update", "CNC"))
                        // .Destroy(update => update.Action("EditingPopup_Delete", "KnifeList"))
                        .PageSize(10)
                        )
                    )

                </section>
            </div>
        </div>
    </div>

</div>

<script type="text/javascript">
    $(function () {

        $("#btnQuery").click(function (e) {
            e.preventDefault();
            debugger;
            console.log('Query it!');

            var $this = $(this);
            //_trim("updateForm");

            var gridView = $("#grid").data("kendoGrid");
            if (gridView != null) {
                var cnc_ip = $("#CNC_IP").val();

                var filterData = [];

                if (cnc_ip != "") {
                    filterData.push({ "field": "CNC_IP", "operator": "contains", "value": cnc_ip });
                }

                gridView.dataSource.query({
                    filter: filterData,
                    sort: {
                        field: "Model_ID",
                        dir: "desc"
                    },
                    page: 1,
                    pageSize: "10"
                });
            }
        });
    });

</script>
<script type="text/javascript">

    function onDeactivate(e) {


        //不秀建立時間

        $("label[for='CNC_Create_ID']").hide();
        $("#CNC_Create_ID").hide();
        $("label[for='CNC_Modify_ID']").hide();
        $("#CNC_Modify_ID").hide();
        $("label[for='CNC_Create_Name']").hide();
        $("#CNC_Create_Name").hide();
        $("label[for='CNC_Modify_Name']").hide();
        $("#CNC_Modify_Name").hide();

        $("label[for='CNC_Create_DT']").hide();
        $("label[for='CNC_Modify_DT']").hide();
        $(".k-datetimepicker").hide();
        $(".k-select").hide();

        $(".k-grid-update")[0].innerHTML = "確認";
        $(".k-grid-cancel")[0].innerHTML = "取消";

    }


</script>

